<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
            <title>CSUN Map Quiz</title>
            <style>
                #map {
                    width: 100%;
                    height: 600px;
                    border: 2px solid #333;
                }
                #prompt, #score {
                    margin: 10px;
                    font-family: Arial, sans-serif;
                    font-size: 16px;
                }
                
                h2 {
                    font-family: Verdana, sans-serif;
                    color: #333;
                }
                
                button {
                    margin: 10px;
                    padding: 8px 16px;
                    font-size: 14px;
                    cursor: pointer;
                    background-color: #0066cc;
                    color: white;
                    border: none;
                    border-radius: 4px;
                }
                
                button:hover {
                    background-color: #004c99;
                }
                
            </style>
            <!-- Load Google Maps API -->
            <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDec2iRSTphXQ7bddZXRXB6NOw0PiIlSBk&libraries=geometry&callback=initMap"></script>
    </head>
    <body>
        <h2>CSUN Location Quiz</h2>
        <div id="prompt"></div>
        <div id="map"></div>
        <div id="score"></div>
        <button id="restartBtn" style="display:none;">Restart Quiz</button>
        
        <script>
            //Initialize map
            let map;
            let currentIndex = 0;
            let score = 0;
            let startTime;
            
            // Location array (sample coordinates, adjust as needed)
            const locations = [
                    {   name: "CSUN Library", lat: 34.24018, lng: -118.52845 },
                    {   name: "Bayramian Hall", lat: 34.24039, lng: -118.53133 },
                    {   name: "Jacaranda Hall", lat: 34.24118, lng: -118.52890 },
                    {   name: "University Student Union", lat: 34.24018, lng: -118.52705 },
                    {   name: "Student Recreation Center", lat: 34.23995, lng: -118.52492 },
                    {   name: "Bookstein Hall", lat: 34.24206, lng: -118.53045 },
                    {   name: "Chaparral Hall", lat: 34.23829, lng: -118.52711 },
                    {   name: "Magnolia Hall", lat: 34.23943, lng: -118.52829 },
                    {   name: "Manzanita Hall", lat: 34.23775, lng: -118.53028 },
                    {   name: "The Soraya", lat: 34.23602, lng: -118.52848 }
                ];
                
                function initMap() {
                    map = new google.maps.Map(document.getElementById("map"), {
                        center: { lat: 34.239, lng: -118.528 },
                        zoom: 16,
                        disableDefaultUI: true,
                        draggable: true,
                        scrollwheel: false,
                        disableDoubleClickZoom: true
                    });
                    
                    const bounds = new google.maps.LatLngBounds();
                    locations.forEach(loc => bounds.extend(new google.maps.LatLng(loc.lat, loc.lng)));
                    map.fitBounds(bounds);
                    
                    locations.forEach(loc => {
                        bounds.extend(new google.maps.LatLng(loc.lat, loc.lng));
                    });
                    
                    map.fitBounds(bounds);
                    
                    const listener = google.maps.event.addListenerOnce(map, "idle", function() {
                        if (map.getZoom() > 17) map.setZoom(17);
                    })
                    google.maps.event.addListener(map, "dblclick", function(event) {
                        checkAnswer(event.latLng);
                    });
                    
                    startGame();
                }
               
                function startGame() {
                    currentIndex = 0;
                    score = 0;
                    startTime = Date.now();
                    document.getElementById("score").innerText = "";
                    document.getElementById("restartBtn").style.display = "none";
                    nextPrompt();
                }
                
                function nextPrompt() {
                    if (currentIndex < locations.length) {
                        document.getElementById("prompt").innerText =
                        "Double-click where " + locations[currentIndex].name + " is.";
                    } else {
                        endGame();
                    }
                }
                
                function checkAnswer(clickedLatLng) {
                    const loc = locations[currentIndex];
                    const distance = google.maps.geometry.spherical.computeDistanceBetween(
                        clickedLatLng,
                         new google.maps.LatLng(loc.lat, loc.lng)
                    );
                    
                    let iconUrl;
                    if (distance < 50) { // within 50 meters tolerance
                        alert("Correct!");
                        score++;
                        iconUrl = "http://maps.google.com/mapfiles/ms/icons/green-dot.png";
                    } else {
                        alert("Wrong!");
                        iconUrl = "http://maps.google.com/mapfiles/ms/icons/red-dot.png";
                    }
                    
                    new google.maps.Marker({
                        position: { lat: loc.lat, lng: loc.lng },
                        map: map,
                        icon: iconUrl,
                        animation: google.maps.Animation.DROP
                    });
                    
                    currentIndex++;
                    nextPrompt();
                }
            
                function endGame() {
                    let totalTime = ((Date.now() - startTime) / 1000).toFixed(1);
                    document.getElementById("score").innerText = "Game Over! You got " + score + " out of " + locations.length +
                    " correct in " + totalTime + " seconds.";
                
            
                // High score system
                let bestScore = localStorage.getItem("highscore") || 0;
                if (score > bestScore) {
                    localStorage.setItem("highscore", score);
                    alert("New High Score: " + score);
                } else {
                    alert("High Score remains: " + bestScore);
                }
            
                document.getElementById("restartBtn").style.display = "inline-block";
            
                }
                
                document.getElementById("restartBtn").addEventListener("click", startGame);
            
                </script>
                </body>
                </html>
                               
